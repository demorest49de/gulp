{"version":3,"file":"../../../js/module/shop/timer.js","names":["handleTimer","changeBannerPromoText","document","querySelector","remove","timerPromoText","textContent","classList","add","closest","deadline","hasAttribute","insertAdjacentHTML","deadlineAttr","getAttribute","timerBlockDays","timerBlockHour","timerBlockMinutes","timerBlockSeconds","textDays","textHour","textMinutes","textSeconds","start","timer","dateStop","Date","getTime","timeRemaining","now","Math","abs","getTimezoneOffset","seconds","floor","minutes","hours","days","getTimeRemaining","day","hour","min","sec","dayNumber","timerObject","timeMeasure","declension","text","digits","number","Array","from","String","n","Number","length","last","slice","declensions","split","j","x","y","handleTextDeclension","intevalId","setTimeout","clearTimeout"],"sources":["module/shop/timer.js"],"mappings":"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","sourcesContent":["export const handleTimer = () => {\r\n\r\n    const changeBannerPromoText = () => {\r\n        const timer = document.querySelector('.timer');\r\n        timer.remove();\r\n        const timerPromoText = document.querySelector('.item__text-notebook');\r\n        timerPromoText.textContent = 'ноутбуки - всегда отличный подарок';\r\n        timerPromoText.classList.add('item__text-notebook-changed');\r\n        const itemGallery = timerPromoText.closest('.item__gallery-notebook');\r\n        itemGallery.classList.add('item__gallery-notebook-changed');\r\n    };\r\n\r\n    const deadline = document.querySelector('.item__timer.timer');\r\n    if (deadline) {\r\n        const hasDeadlineAttr = deadline.hasAttribute('data-timer-deadline');\r\n        if (hasDeadlineAttr) {\r\n            deadline.insertAdjacentHTML('beforeend', `\r\n            <p class=\"timer__title\">До конца акции:</p>\r\n            <div class=\"timer__block\">\r\n              <p><span class=\"timer__count timer-days-num\">00\r\n              </span><span class=\"timer__units  timer-days-text\">дней</span></p>\r\n              <p><span class=\"timer__count timer-hours-num\">00\r\n              </span><span class=\"timer__units  timer-hours-text\">часов</span></p>\r\n              <p><span class=\"timer__count timer-minutes-num\">00\r\n              </span><span class=\"timer__units  timer-minutes-text\">минут</span></p>\r\n              <p><span class=\"timer__count timer-seconds-num\">00\r\n              </span><span class=\"timer__units  timer-seconds-text\">секунд</span></p>\r\n            </div>\r\n          `);\r\n        }\r\n    } else {\r\n        changeBannerPromoText();\r\n        return;\r\n    }\r\n\r\n    const deadlineAttr = deadline.getAttribute('data-timer-deadline');\r\n    const timerBlockDays = document.querySelector('.timer-days-num');\r\n    const timerBlockHour = document.querySelector('.timer-hours-num');\r\n    const timerBlockMinutes = document.querySelector('.timer-minutes-num');\r\n    const timerBlockSeconds = document.querySelector('.timer-seconds-num');\r\n\r\n    const textDays = document.querySelector('.timer-days-text');\r\n    const textHour = document.querySelector('.timer-hours-text');\r\n    const textMinutes = document.querySelector('.timer-minutes-text');\r\n    const textSeconds = document.querySelector('.timer-seconds-text');\r\n\r\n    const getTimeRemaining = () => {\r\n        const dateStop = new Date(deadlineAttr).getTime();\r\n        if (!dateStop) return false;\r\n        const dateNow = Date.now();\r\n\r\n        const timezoneoffset = Math.abs(new Date().getTimezoneOffset()) * 60 * 1000;\r\n        const myTimeZone = (+3) * 60 * 60 * 1000;\r\n\r\n        const myCurrentTime = dateNow - timezoneoffset + myTimeZone;\r\n\r\n        const timeRemaining = dateStop - myCurrentTime;\r\n        // const timeRemaining = dateStop - dateNow;\r\n\r\n        const seconds = Math.floor(timeRemaining / 1000 % 60);\r\n        const minutes = Math.floor(timeRemaining / 1000 / 60 % 60);\r\n        const hours = Math.floor(timeRemaining / 1000 / 60 / 60 % 24);\r\n        const days = Math.floor(timeRemaining / 1000 / 60 / 60 / 24);\r\n\r\n\r\n        return {\r\n            days, hours, minutes, seconds, timeRemaining,\r\n        };\r\n    };\r\n\r\n    const getArrayOfDigits = (number) => {\r\n        return Array.from(String(number), n => Number(n));\r\n    };\r\n\r\n    const handleTextDeclension = ({days: day, hours: hour, minutes: min, seconds: sec, timeRemaining}) => {\r\n        const dayNumber = [[0], [1], [2, 4]];\r\n        const timerObject = [\r\n            {timeMeasure: day, declension: 'дней-день-дня', text: textDays},\r\n            {timeMeasure: hour, declension: 'часов-час-часа', text: textHour},\r\n            {timeMeasure: min, declension: 'минут-минута-минуты', text: textMinutes},\r\n            {timeMeasure: sec, declension: 'секунд-секунда-секунды', text: textSeconds},\r\n        ];\r\n        for (const {timeMeasure, declension, text} of timerObject) {\r\n            const digits = getArrayOfDigits(timeMeasure);\r\n            if (digits.length > 1 && digits[digits.length - 2] === 1) continue;\r\n            const last = digits.slice(-1)[0];\r\n            const declensions = declension.split('-');\r\n            for (let j = 0; j < dayNumber.length; j++) {\r\n                const [x, y] = dayNumber[j];\r\n                if (!y && last === x) {\r\n                    text.textContent = declensions[j];\r\n                } else if (last >= x && last <= y) {\r\n                    text.textContent = declensions[j];\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    const start = () => {\r\n        const timer = getTimeRemaining();\r\n        if (!timer) return changeBannerPromoText();\r\n        handleTextDeclension(timer);\r\n\r\n\r\n        timer.days === 0 ? timerBlockDays.closest('p').remove() : (timerBlockDays.textContent = `${timer.days}`);\r\n        if (timer.days < 10) timerBlockDays.classList.add('timer__count_less-ten');\r\n        timerBlockHour.textContent = timer.hours < 10 ? `0${timer.hours}` : `${timer.hours}`;\r\n        timerBlockMinutes.textContent = timer.minutes < 10 ? `0${timer.minutes}` : `${timer.minutes}`;\r\n        timerBlockSeconds.textContent = timer.seconds < 10 ? `0${timer.seconds}` : `${timer.seconds}`;\r\n\r\n\r\n        const intevalId = setTimeout(start, 1000);\r\n\r\n        if (timer.timeRemaining <= 0) {\r\n\r\n            clearTimeout(intevalId);\r\n            changeBannerPromoText();\r\n        }\r\n    };\r\n\r\n\r\n    start();\r\n};\r\n"]}